(()=>{"use strict";const t="https://kite-demo.zerodha.com/positions",e="https://console.zerodha.com/account/segment-activation?switchToggle=0",o="User_Stock_Opening_Bal",n="Stop_Loss_Percentage",c="User_Data_Collection_Date",i="Loss_Date",l="Enter percentage of your opening balance today where you want to stop trading for today ?";function a(t,e){var o={};o[t]=e,chrome.storage.local.set(o,(function(){console.log("Data saved:",o)}))}function r(t,e){chrome.storage.local.get(t,(function(o){console.log("Data loaded:",o),e&&e(o[t])}))}function s(t,o,n,c,l){if(t&&n){var r=document.querySelector(".open-positions tfoot td:nth-last-child(2)"),d=parseFloat(n)/100*parseFloat(o),g=parseFloat(r.textContent);if(g<=0-d){var f=(new Date).toISOString();a(i,f),u(e)}else g>=l&&(o+=o==t?g:g-(o-t),l+=c),setTimeout((function(){s(t,o,n,c,l)}),1e3)}}function u(t){chrome.runtime.sendMessage({action:"navigateToPage",url:t})}const d=window.location.href;var g,f,m,p;d.includes("https://kite-demo.zerodha.com/")&&(g=new Date,f=g.toISOString(),m=null,p=null,r(n,(function(t){p=t,r(c,(function(t){if(m=t,p)if(new Date(m).toDateString()===g.toDateString())console.log("Today's input: "+p);else{var e=prompt(l);a(n,e),a(c,f)}else e=prompt(l),a(n,e),a(c,f)}))}))),d.includes("https://kite-demo.zerodha.com/funds")&&setTimeout((function(){!function(){const t=document.querySelector("div.six.columns");if(t&&t.querySelector("h3.title span.name").textContent.trim().toLowerCase().includes("equity")){let e;t.querySelectorAll("table.table tbody tr").forEach((t=>{"Opening balance"===t.querySelector("td:first-child").textContent.trim()&&(e=t.querySelector("td:nth-child(2)").textContent.trim())})),e=e.replace(/,/g,""),a(o,parseFloat(e))}}(),u(t)}),2e3),d.includes(t)&&setTimeout((function(){r(o,(function(t){var e=t;console.log("User_Stock_Opening_Bal:",e),r("Trailing_Stop_Loss_Percentage",(function(t){console.log("User_Trailing_Stop_Loss_Percentage:",t);var o=parseFloat(t)/100*parseFloat(e);r(n,(function(t){var n=t;console.log("User_Provided_Stop_Loss_Percentage:",n),s(e,e,n,o,o)}))}))}))}),2e3),d==e&&setTimeout((function(){var t=new Date;r(i,(function(e){var o;if(null!=e){var n=new Date(e);n.toDateString()===t.toDateString()&&(console.log("Today's input: "+n),o=!1,document.querySelectorAll(".su-switch-group #NSE_CFX").forEach((function(t){t.checked&&(o=!0,t.checked=!1)})),o&&(setTimeout((function(){for(var t=document.querySelectorAll(".btn.btn-blue"),e=0;e<t.length;e++)if("Continue"===t[e].textContent.trim()){t[e].click();break}console.log("kill switch clicked")}),2e3),setTimeout((function(){for(var t=document.querySelectorAll(".modal-container button.btn.btn-blue"),e=0;e<t.length;e++)if("Continue"===t[e].textContent.trim()){t[e].click(),console.log("kill switch clicked");break}console.log("kill switch clicked")}),2e3)))}}))}),2e3)})();