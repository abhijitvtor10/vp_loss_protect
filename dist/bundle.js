(()=>{"use strict";const e="https://kite-demo.zerodha.com/positions",o="https://console.zerodha.com/account/segment-activation?killswitch=0",t="https://kite-demo.zerodha.com/positions?exit=0",n="User_Stock_Opening_Bal",c="Stop_Loss_Percentage",l="User_Data_Collection_Date",i="Loss_Date",r="Enter percentage of your opening balance today where you want to stop trading for today ?";function a(e,o){var t={};t[e]=o,chrome.storage.local.set(t,(function(){console.log("Data saved:",t)}))}function s(e,o){chrome.storage.local.get(e,(function(t){console.log("Data loaded:",t),o&&o(t[e])}))}var u=!1;function g(e,t,n,c,l){if(e&&n){var r=document.querySelector(".open-positions tfoot td:nth-last-child(2)").textContent;console.log("Obtained text from  positions"+r),r=r.replaceAll(",","");var s=parseFloat(n)/100*parseFloat(t);if(u){var m=(new Date).toISOString();console.log("Current time : "+m),console.log("Current Stop loss amount : "+s),console.log("Current balance : "+t),u=!1}var f=parseFloat(r);if(console.log("Opening balance : "+e),console.log(" currentPositionSummaryAmount : "+f),console.log("current_Bal : "+t),console.log(" stop_loss_amount : "+s),console.log(" comparison "+(e+f<=t-s)),console.log("======================================================="),e+f<=t-s)console.log("stop loss hit you are saved enjoy!"),console.log("Opening balance : "+e),console.log(" currentPositionSummaryAmount : "+f),console.log("current_Bal : "+t),console.log(" stop_loss_amount : "+s),m=(new Date).toISOString(),a(i,m),d(o);else{if(f>=l){var p;t+=p=t==e?f:f-(t-e),s+=p,u=!0,l+=c}setTimeout((function(){g(e,t,n,c,l)}),1e3)}}}function d(e){chrome.runtime.sendMessage({action:"navigateToPage",url:e})}const m=window.location.href;var f,p,h,S;m.includes("https://kite-demo.zerodha.com/")&&(f=new Date,p=f.toISOString(),h=null,S=null,s(c,(function(e){S=e,s(l,(function(e){if(h=e,S)if(new Date(h).toDateString()===f.toDateString())console.log("Today's input: "+S);else{var o=prompt(r);a(c,o),a(l,p)}else o=prompt(r),a(c,o),a(l,p)}))}))),m.includes("https://kite-demo.zerodha.com/funds")&&setTimeout((function(){!function(){const e=document.querySelector("div.six.columns");var o;e&&(e.querySelector("h3.title span.name").textContent.trim().toLowerCase().includes("equity")&&(e.querySelectorAll("table.table tbody tr").forEach((e=>{"Opening balance"===e.querySelector("td:first-child").textContent.trim()&&(o=e.querySelector("td:nth-child(2)").textContent.trim())})),o=o.replace(/,/g,""),a(n,parseFloat(o))))}(),d(e)}),2e3),m.includes(e)&&!m.includes(t)&&setTimeout((function(){s(n,(function(e){var o=e;console.log("User_Stock_Opening_Bal:",o),s("Trailing_Stop_Loss_Percentage",(function(e){console.log("User_Trailing_Stop_Loss_Percentage:",e);var t=parseFloat(e)/100*parseFloat(o);s(c,(function(e){var n=e;console.log("User_Provided_Stop_Loss_Percentage:",n),g(o,o,n,t,t)}))}))}))}),2e3),m==o&&setTimeout((function(){var e=new Date;s(i,(function(o){if(null!=o){var n=new Date(o);n.toDateString()===e.toDateString()&&(console.log("Today's input: "+n),i=!1,(l=Date.now()+3e4,function e(){try{c=document.querySelectorAll("input")}catch(o){Date.now()<l&&setTimeout(e,1e3)}}(),c).forEach((function(e){e.checked&&(i=!0,e.checked=!1)})),i&&(setTimeout((function(){for(var e=document.querySelectorAll(".btn.btn-blue"),o=0;o<e.length;o++)if("Continue"===e[o].textContent.trim()){e[o].click();break}console.log("kill switch clicked")}),2e3),setTimeout((function(){for(var e=document.querySelectorAll(".modal-container button.btn.btn-blue"),o=0;o<e.length;o++)if("Continue"===e[o].textContent.trim()){e[o].click(),console.log("kill switch clicked");break}console.log("kill switch clicked"),d(t)}),2e3)))}var c,l,i}))}),3e3),m==t&&setTimeout((function(){var e=new Date;s(i,(function(o){if(null!=o){var t=new Date(o);t.toDateString()===e.toDateString()&&(console.log("Today's input: "+t),function(){var e=document.querySelectorAll(".data-table tbody tr");try{e.forEach((function(e){e.querySelector('.su-checkbox-group input[type="checkbox"]').click()}))}catch{console.log("ignored error while clicking on the check boxes")}setTimeout((function(){document.querySelector(".button-blue").click(),setTimeout((function(){document.querySelector(".modal-container").querySelector(".button-blue").click()}),2e3)}),2e3)}())}}))}),2e3)})();