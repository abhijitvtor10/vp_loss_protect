(()=>{"use strict";const e="https://kite-demo.zerodha.com/positions",t="https://console.zerodha.com/account/segment-activation?killswitch=0",o="https://kite-demo.zerodha.com/positions?exit=0",n="User_Stock_Opening_Bal",c="Stop_Loss_Percentage",i="User_Data_Collection_Date",l="Loss_Date",r="Enter percentage of your opening balance today where you want to stop trading for today ?";function a(e,t){var o={};o[e]=t,chrome.storage.local.set(o,(function(){console.log("Data saved:",o)}))}function s(e,t){chrome.storage.local.get(e,(function(o){console.log("Data loaded:",o),t&&t(o[e])}))}function u(e,o,n,c,i){if(e&&n){var r=document.querySelector(".open-positions tfoot td:nth-last-child(2)"),s=parseFloat(n)/100*parseFloat(o),f=parseFloat(r.textContent);if(f<=0-s){var g=(new Date).toISOString();a(l,g),d(t)}else f>=i&&(o+=o==e?f:f-(o-e),i+=c),setTimeout((function(){u(e,o,n,c,i)}),1e3)}}function d(e){chrome.runtime.sendMessage({action:"navigateToPage",url:e})}const f=window.location.href;var g,m,p,h;f.includes("https://kite-demo.zerodha.com/")&&(g=new Date,m=g.toISOString(),p=null,h=null,s(c,(function(e){h=e,s(i,(function(e){if(p=e,h)if(new Date(p).toDateString()===g.toDateString())console.log("Today's input: "+h);else{var t=prompt(r);a(c,t),a(i,m)}else t=prompt(r),a(c,t),a(i,m)}))}))),f.includes("https://kite-demo.zerodha.com/funds")&&setTimeout((function(){!function(){const e=document.querySelector("div.six.columns");if(e&&e.querySelector("h3.title span.name").textContent.trim().toLowerCase().includes("equity")){let t;e.querySelectorAll("table.table tbody tr").forEach((e=>{"Opening balance"===e.querySelector("td:first-child").textContent.trim()&&(t=e.querySelector("td:nth-child(2)").textContent.trim())})),t=t.replace(/,/g,""),a(n,parseFloat(t))}}(),d(e)}),2e3),f.includes(e)&&!f.includes(o)&&setTimeout((function(){s(n,(function(e){var t=e;console.log("User_Stock_Opening_Bal:",t),s("Trailing_Stop_Loss_Percentage",(function(e){console.log("User_Trailing_Stop_Loss_Percentage:",e);var o=parseFloat(e)/100*parseFloat(t);s(c,(function(e){var n=e;console.log("User_Provided_Stop_Loss_Percentage:",n),u(t,t,n,o,o)}))}))}))}),2e3),f==t&&setTimeout((function(){var e=new Date;s(l,(function(t){if(null!=t){var n=new Date(t);n.toDateString()===e.toDateString()&&(console.log("Today's input: "+n),l=!1,(i=Date.now()+3e4,function e(){try{c=document.querySelectorAll("input")}catch(t){Date.now()<i&&setTimeout(e,1e3)}}(),c).forEach((function(e){e.checked&&(l=!0,e.checked=!1)})),l&&(setTimeout((function(){for(var e=document.querySelectorAll(".btn.btn-blue"),t=0;t<e.length;t++)if("Continue"===e[t].textContent.trim()){e[t].click();break}console.log("kill switch clicked")}),2e3),setTimeout((function(){for(var e=document.querySelectorAll(".modal-container button.btn.btn-blue"),t=0;t<e.length;t++)if("Continue"===e[t].textContent.trim()){e[t].click(),console.log("kill switch clicked");break}console.log("kill switch clicked"),d(o)}),2e3)))}var c,i,l}))}),3e3),f==o&&setTimeout((function(){var e=new Date;s(l,(function(t){if(null!=t){var o=new Date(t);o.toDateString()===e.toDateString()&&(console.log("Today's input: "+o),function(){var e=document.querySelectorAll(".data-table tbody tr");try{e.forEach((function(e){parseFloat(e.querySelector(".pnl span").innerText)<0&&e.querySelector('.su-checkbox-group input[type="checkbox"]').click()}))}catch{console.log("ignored error while clicking on the check boxes")}setTimeout((function(){document.querySelector(".button-blue").click(),setTimeout((function(){document.querySelector(".modal-container").querySelector(".button-blue").click()}),2e3)}),2e3)}())}}))}),2e3)})();