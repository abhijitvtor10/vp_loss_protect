(()=>{"use strict";const e="https://kite.zerodha.com/positions",t="https://console.zerodha.com/account/segment-activation?killswitch=0",o="https://kite.zerodha.com/positions?exit=0",n="User_Stock_Opening_Bal",c="Stop_Loss_Percentage",l="User_Data_Collection_Date",i="Loss_Date",r="Enter percentage of your opening balance today where you want to stop trading for today ?";function a(e,t){var o={};o[e]=t,chrome.storage.local.set(o,(function(){console.log("Data saved:",o)}))}function s(e,t){chrome.storage.local.get(e,(function(o){console.log("Data loaded:",o),t&&t(o[e])}))}var u=!1;function g(e,o,n,c,l){if(e&&n){let r=document.querySelector(".open-positions tfoot td:nth-last-child(2)"),s=parseFloat(n)/100*parseFloat(o);if(u){let e=(new Date).toISOString();console.log("Current time : "+e),console.log("Current Stop loss amount : "+s),console.log("Current balance : "+o),u=!1}let f=parseFloat(r.textContent);if(e+f<=o-s){console.log("stop loss hit you are saved enjoy!"),console.log("Opening balance : "+e),console.log(" currentPositionSummaryAmount : "+f),console.log("current_Bal : "+o),console.log(" stop_loss_amount : "+s);let n=(new Date).toISOString();a(i,n),d(t)}else{if(f>=l){let t=0;t=o==e?f:f-(o-e),o+=t,s+=t,u=!0,l+=c}setTimeout((function(){g(e,o,n,c,l)}),1e3)}}}function d(e){chrome.runtime.sendMessage({action:"navigateToPage",url:e})}const f=window.location.href;f.includes("https://kite.zerodha.com/")&&function(){let e=new Date,t=e.toISOString(),o=null,n=null;s(c,(function(i){n=i,s(l,(function(i){if(o=i,n)if(new Date(o).toDateString()===e.toDateString())console.log("Today's input: "+n);else{let e=prompt(r);a(c,e),a(l,t)}else{let e=prompt(r);a(c,e),a(l,t)}}))}))}(),f.includes("https://kite.zerodha.com/funds")&&setTimeout((function(){!function(){const e=document.querySelector("div.six.columns");if(e&&e.querySelector("h3.title span.name").textContent.trim().toLowerCase().includes("equity")){let t;e.querySelectorAll("table.table tbody tr").forEach((e=>{"Opening balance"===e.querySelector("td:first-child").textContent.trim()&&(t=e.querySelector("td:nth-child(2)").textContent.trim())})),t=t.replace(/,/g,""),a(n,parseFloat(t))}}(),d(e)}),2e3),f.includes(e)&&!f.includes(o)&&setTimeout((function(){s(n,(function(e){var t=e;console.log("User_Stock_Opening_Bal:",t),s("Trailing_Stop_Loss_Percentage",(function(e){console.log("User_Trailing_Stop_Loss_Percentage:",e);var o=parseFloat(e)/100*parseFloat(t);s(c,(function(e){var n=e;console.log("User_Provided_Stop_Loss_Percentage:",n),g(t,t,n,o,o)}))}))}))}),2e3),f==t&&setTimeout((function(){var e=new Date;s(i,(function(t){if(null!=t){var n=new Date(t);n.toDateString()===e.toDateString()&&(console.log("Today's input: "+n),i=!1,(l=Date.now()+3e4,function e(){try{c=document.querySelectorAll("input")}catch(t){Date.now()<l&&setTimeout(e,1e3)}}(),c).forEach((function(e){e.checked&&(i=!0,e.checked=!1)})),i&&(setTimeout((function(){for(var e=document.querySelectorAll(".btn.btn-blue"),t=0;t<e.length;t++)if("Continue"===e[t].textContent.trim()){e[t].click();break}console.log("kill switch clicked")}),2e3),setTimeout((function(){for(var e=document.querySelectorAll(".modal-container button.btn.btn-blue"),t=0;t<e.length;t++)if("Continue"===e[t].textContent.trim()){e[t].click(),console.log("kill switch clicked");break}console.log("kill switch clicked"),d(o)}),2e3)))}var c,l,i}))}),3e3),f==o&&setTimeout((function(){var e=new Date;s(i,(function(t){if(null!=t){var o=new Date(t);o.toDateString()===e.toDateString()&&(console.log("Today's input: "+o),function(){var e=document.querySelectorAll(".data-table tbody tr");try{e.forEach((function(e){parseFloat(e.querySelector(".pnl span").innerText)<0&&e.querySelector('.su-checkbox-group input[type="checkbox"]').click()}))}catch{console.log("ignored error while clicking on the check boxes")}setTimeout((function(){document.querySelector(".button-blue").click(),setTimeout((function(){document.querySelector(".modal-container").querySelector(".button-blue").click()}),2e3)}),2e3)}())}}))}),2e3)})();