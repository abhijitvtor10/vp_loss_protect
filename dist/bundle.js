(()=>{"use strict";const o="https://kite.zerodha.com/positions",e="https://console.zerodha.com/account/segment-activation?killswitch=0",t="https://kite.zerodha.com/positions?exit=0",n="User_Stock_Opening_Bal",l="Stop_Loss_Percentage",c="User_Data_Collection_Date",i="Loss_Date",r="Enter percentage of your opening balance today where you want to stop trading for today ?";function a(o,e){var t={};t[o]=e,chrome.storage.local.set(t,(function(){console.log("Data saved:",t)}))}function s(o,e){chrome.storage.local.get(o,(function(t){console.log("Data loaded:",t),e&&e(t[o])}))}var u=!1;function g(o,t,n,l,c){try{if(o&&n){var r=document.querySelector(".open-positions tfoot td:nth-last-child(2)").textContent;console.log("Obtained text from  position "+r),r=r.replaceAll(",","");var s=parseFloat(n)/100*parseFloat(t);if(u){var p=parseFloat(100-n)/100*parseFloat(t),d=(new Date).toISOString();console.log("Current time : "+d),console.log("Current Stop loss amount : "+s),console.log("minimum profit : "(p-o)),console.log("Current balance : "+t),u=!1}var f=parseFloat(r);if(console.log("Opening balance : "+o),console.log(" currentPositionSummaryAmount : "+f),p=parseFloat(100-n)/100*parseFloat(t),console.log("minimum profit : "+(p-o)),console.log("current_Bal : "+t),console.log(" stop_loss_amount : "+s),console.log(" comparison "+(o+f<=t-s)),console.log("======================================================="),o+f<=t-s)console.log("stop loss hit you are saved enjoy!"),console.log("Opening balance : "+o),console.log(" currentPositionSummaryAmount : "+f),console.log("current_Bal : "+t),console.log(" stop_loss_amount : "+s),d=(new Date).toISOString(),a(i,d),m(e);else{if(f>=c){var h;t+=h=t==o?f:f-(t-o),s+=h,u=!0,c+=l}setTimeout((function(){g(o,t,n,l,c)}),1e3)}}}catch(e){console.log("Got error while iterating on the positions re-iterating again",e),setTimeout((function(){g(o,t,n,l,c)}),2e3)}}function m(o){chrome.runtime.sendMessage({action:"navigateToPage",url:o})}const p=window.location.href;var d,f,h,S;p.includes("https://kite.zerodha.com/")&&(d=new Date,f=d.toISOString(),h=null,S=null,s(l,(function(o){S=o,s(c,(function(o){if(h=o,S)if(new Date(h).toDateString()===d.toDateString())console.log("Today's input: "+S);else{var e=prompt(r);a(l,e),a(c,f)}else e=prompt(r),a(l,e),a(c,f)}))}))),p.includes("https://kite.zerodha.com/funds")&&setTimeout((function(){!function(){const o=document.querySelector("div.six.columns");var e;o&&(o.querySelector("h3.title span.name").textContent.trim().toLowerCase().includes("equity")&&(o.querySelectorAll("table.table tbody tr").forEach((o=>{"Opening balance"===o.querySelector("td:first-child").textContent.trim()&&(e=o.querySelector("td:nth-child(2)").textContent.trim())})),e=e.replace(/,/g,""),a(n,parseFloat(e))))}(),m(o)}),2e3),p.includes(o)&&!p.includes(t)&&setTimeout((function(){s(n,(function(o){var e=o;console.log("User_Stock_Opening_Bal:",e),s("Trailing_Stop_Loss_Percentage",(function(o){console.log("User_Trailing_Stop_Loss_Percentage:",o);var t=parseFloat(o)/100*parseFloat(e);s(l,(function(o){var n=o;console.log("User_Provided_Stop_Loss_Percentage:",n),g(e,e,n,t,t)}))}))}))}),2e3),p==e&&setTimeout((function(){var o=new Date;s(i,(function(e){if(null!=e){var n=new Date(e);n.toDateString()===o.toDateString()&&(console.log("Today's input: "+n),i=!1,(c=Date.now()+3e4,function o(){try{l=document.querySelectorAll("input")}catch(e){Date.now()<c&&setTimeout(o,1e3)}}(),l).forEach((function(o){o.checked&&(i=!0,o.checked=!1)})),i&&(setTimeout((function(){for(var o=document.querySelectorAll(".btn.btn-blue"),e=0;e<o.length;e++)if("Continue"===o[e].textContent.trim()){o[e].click();break}console.log("kill switch clicked")}),5e3),setTimeout((function(){for(var o=document.querySelectorAll(".modal-container button.btn.btn-blue"),e=0;e<o.length;e++)if("Continue"===o[e].textContent.trim()){o[e].click(),console.log("kill switch clicked");break}console.log("kill switch clicked"),m(t)}),5e3)))}var l,c,i}))}),3e3),p==t&&setTimeout((function(){var o=new Date;s(i,(function(e){if(null!=e){var t=new Date(e);t.toDateString()===o.toDateString()&&(console.log("Today's input: "+t),function(){var o=document.querySelectorAll(".data-table tbody tr");try{o.forEach((function(o){o.querySelector('.su-checkbox-group input[type="checkbox"]').click()}))}catch{console.log("ignored error while clicking on the check boxes")}setTimeout((function(){document.querySelector(".button-blue").click(),setTimeout((function(){document.querySelector(".modal-container").querySelector(".button-blue").click()}),2e3)}),2e3)}())}}))}),2e3)})();